<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verify Email - Fertilizer Portal</title>
  <link rel="stylesheet" href="feature.css" />
</head>
<body>
  <main class="feature-content">
    <h1>Verifying email...</h1>
    <p id="message">Please wait while we verify your email.</p>
  </main>

  <script>
    async function verify() {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      const msg = document.getElementById('message');
      if (!token) {
        msg.textContent = 'Missing verification token.';
        return;
      }
      try {
        const res = await fetch('/api/auth/verify?token=' + encodeURIComponent(token), { credentials: 'include' });
        const data = await res.json();
        if (!res.ok) {
          msg.textContent = 'Verification failed: ' + (data.error || 'Unknown error');
        } else {
          msg.textContent = 'Email verified! Redirecting to dashboard...';
          // Redirect to dashboard/home after short delay
          setTimeout(() => (window.location.href = 'home.html'), 1500);
        }
      } catch (err) {
        msg.textContent = 'Network error while verifying: ' + err.message;
      }
    }
    verify();
  </script>
</body>
</html>
